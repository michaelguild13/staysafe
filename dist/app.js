"use strict";function getIconType(a){var a=a.replace(/\W/g,"").toLowerCase(),b={"default":{color:"#dfdfde",symbol:"circle"},accidentinvestigation:{color:"#ff6501",symbol:"heliport"},assault:{color:"#ba98cd",symbol:"logging"},arrest:{color:"#a7bd2f",symbol:"police"},animalcomplaints:{color:"#bd8c2f",symbol:"dog-park"},burglary:{color:"#c60000",symbol:"village"},robbery:{color:"#fffdd6",symbol:"pitch"},carprowl:{color:"#a0b7da",symbol:"car"},disturbances:{color:"#014783",symbol:"oil-well"},falsealarms:{color:"#8caba8",symbol:"roadblock"},fraudcalls:{color:"#ebdada",symbol:"emergency-telephone"},liquorviolations:{color:"#d7c6cf",symbol:"alcohol-shop"},mentalhealth:{color:"#a2798f",symbol:"disability"},narcoticscomplaints:{color:"#c39797",symbol:"pharmacy"},nuisancemischief:{color:"#d3ffce",symbol:"skiing"},otherproperty:{color:"#e6ac39",symbol:"building"},prostitution:{color:"#89a647",symbol:"heart"},propertydamage:{color:"#855549",symbol:"baseball"},prowler:{color:"#6b64a8",symbol:"school"},propertymissingfound:{color:"#d77b37",symbol:"bicycle"},persondowninjury:{color:"#57aea0",symbol:"hospital"},personslostfoundmissing:{color:"#00e6e6",symbol:"playground"},shoplifting:{color:"#009999",symbol:"grocery"},suspiciouscircumstances:{color:"#11b2b2",symbol:"theatre"},trafficrelatedcalls:{color:"#11b7b7",symbol:"bus"},threatsharassment:{color:"#afb4bb",symbol:"danger"},trespass:{color:"#e93b46",symbol:"prison"}};return b[a]||b["default"]}function makeMarker(a){var b=getIconType(a.event_clearance_group);L.mapbox.featureLayer({cad_cdw_id:a.cad_cdw_id,type:"Feature",geometry:{type:"Point",coordinates:[a.longitude,a.latitude]},properties:{title:a.event_clearance_group+" at "+a.hundred_block_location+" ("+a.cad_event_number+")",description:a.initial_type_description,"marker-size":"large","marker-color":b.color,"marker-symbol":b.symbol}}).addTo(map)}var MapBox=React.createClass({displayName:"MapBox",componentDidMount:function(){map=L.mapbox.map("map","mapbox.streets"),map.setView([47.594972,-122.331518],15),layer.on("ready",function(){})},render:function(){return React.createElement("section",{id:"mapbox",className:"col-sm-8 col-sm-push-4"},React.createElement("div",{id:"map"}))}}),MarkerCollection=React.createClass({displayName:"MarkerCollection",getInitialState:function(){return{crimes:[]}},componentDidMount:function(){$.get(this.props.source,function(a){this.isMounted()&&this.setState({crimes:a})}.bind(this))},handleMarker:function(a){var b=a.target.dataset.lat,c=a.target.dataset.lng;map.setView([b,c],18)},handleFilter:function(a){var b=a.target.dataset.filter,c=this.state.crimes,d=function(a){return function(b,c){var b=b[a],c=c[a];return c>b?-1:b>c?1:0}};b=d(b),this.setState({crimes:c.sort(b)})},render:function(){var a=this,b=this.state.crimes||[];return React.createElement("div",{className:"col-sm-4 col-sm-pull-8"},React.createElement("nav",{className:"navbar navbar-default"},React.createElement("div",{className:"container-fluid"},React.createElement("ul",{className:"nav navbar-nav"},React.createElement("li",null,React.createElement("a",{className:"",onClick:a.handleFilter,"data-filter":"event_clearance_group"},"Filter on Group")),React.createElement("li",null,React.createElement("a",{className:"",onClick:a.handleFilter,"data-filter":"event_clearance_code"},"Filter code"))))),React.createElement("section",{id:"crimes-listings"},React.createElement("ul",{className:"list-group"},b.map(function(b){return makeMarker(b),React.createElement("li",{className:"list-group-item",key:b.cad_event_number},React.createElement("a",{className:"small",onClick:a.handleMarker,"data-lng":b.longitude,"data-lat":b.latitude},b.event_clearance_group),React.createElement("span",{className:"badge"},b.event_clearance_code))}))))}}),Navigation=React.createClass({displayName:"Navigation",componentDidMount:function(){},handleFilter:function(a){var b=a.target.dataset.filter;console.log(b)},render:function(){var a=this;return React.createElement("nav",{className:"navbar navbar-default",id:"top",role:"banner"},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"navbar-header"},React.createElement("button",{type:"button",className:"navbar-toggle collapsed","data-toggle":"collapse","data-target":"#bs-example-navbar-collapse-1","aria-expanded":"false"},React.createElement("span",{className:"sr-only"},"Toggle navigation"),React.createElement("span",{className:"icon-bar"}),React.createElement("span",{className:"icon-bar"}),React.createElement("span",{className:"icon-bar"})),React.createElement("a",{className:"navbar-brand",href:"#"},"StaySafe")),React.createElement("div",{className:"collapse navbar-collapse",id:"bs-example-navbar-collapse-1"},React.createElement("ul",{className:"nav navbar-nav"},React.createElement("li",null,React.createElement("a",{onClick:a.handleFilter,"data-filter":"car"},"Don't Park Here")),React.createElement("li",null,React.createElement("a",{onClick:a.handleFilter,"data-filter":"assult"},"Don't Walk Here")),React.createElement("li",null,React.createElement("a",{onClick:a.handleFilter,"data-filter":"rob"},"Don't Shop Here")),React.createElement("li",null,React.createElement("a",{onClick:a.handleFilter,"data-filter":"stolen"},"Don't Buy a Home Here"))),React.createElement(SearchInput,null))))}}),SearchInput=React.createClass({displayName:"SearchInput",getInitialState:function(){return{value:"800 Occidental Ave S, Seattle, WA 98134"}},setMapView:function(a,b){"undefined"!=typeof b.lbounds&&b.lbounds?map.fitBounds(b.lbounds):b.latlng&&map.setView([b.latlng[0],b.latlng[1]],13)},handleChange:function(a){geocoder.query(a.target.value,this.setMapView),this.setState({value:a.target.value})},render:function(){return React.createElement("form",{className:"navbar-form navbar-left",role:"search"},React.createElement("div",{className:"form-group"},React.createElement("input",{className:"form-control",value:this.state.value,onChange:this.handleChange,placeholder:"insert address"})))}});$(".dropdown-toggle").dropdown();var layer=L.mapbox.tileLayer("mapbox.streets"),geocoder=L.mapbox.geocoder("mapbox.places"),map,App=React.createClass({displayName:"App",getInitialState:function(){return{layer:L.mapbox.tileLayer("mapbox.streets"),geocoder:L.mapbox.geocoder("mapbox.places"),map:null}},render:function(){return React.createElement("div",null,React.createElement(Navigation,null),React.createElement("article",{id:"app",className:"container"},React.createElement("div",{className:"row"},React.createElement(MapBox,null),React.createElement(MarkerCollection,{source:"https://data.seattle.gov/resource/3k2p-39jp.json?$limit=50&$where=within_circle(incident_location, 47.594972, -122.331518, 1609.34)"}))))}});React.render(React.createElement(App,null),document.body);